<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Hostel Login</title>

    <!-- Bootstrap CSS -->
    <!-- <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"> -->
     <link rel="stylesheet" href="../../css/bootstrap.min.css">

    <!-- Bootstrap Icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">

    <!-- Shared form styles (from your project) -->
    <link href="../../css/form.css" rel="stylesheet">
    <link href="../../css/transitions.css" rel="stylesheet">
    <!-- Assign logo for my website -->
     <link rel="shortcut icon" href="../../images/favicon.ico" type="image/x-icon">
</head>

<body>
    <div class="container-center" aria-live="polite">
        <!-- animated shapes (same classes as signup so CSS applies) -->
        <div class="float-shape shape-1" aria-hidden="true"></div>
        <div class="float-shape shape-2" aria-hidden="true"></div>
        <div class="float-shape shape-3" aria-hidden="true"></div>

        <div class="signup-card" role="region" aria-label="Login card">
            <div class="form-side">
                <div class="brand">
                    <div><img style="width: 70px;" src="../../images/logo.png" alt=""></div>
                    <div>
                        <div class="fw-bold">Hoste<span style="color: #3b82f6;">Link</span></div>
                        <div class="muted">Welcome back â€” sign in to continue</div>
                    </div>
                </div>

                <h1>Sign in</h1>
                <p class="lead">Choose your account type and sign in with your email and password.</p>

                <!-- Account type at the top (uses same segmented-toggle styles) -->
                <div style="margin-bottom:0.6rem;">
                    <div class="segmented-toggle" role="tablist" aria-label="Account type">
                        <button type="button" class="active" data-value="student" id="segStudent">Student</button>
                        <button type="button" data-value="agent" id="segAgent">Agent</button>
                    </div>
                    <div class="field-note" id="accountNote" style="margin-top:8px;">Signing in as a student</div>
                </div>

                <form id="loginForm" novalidate style="margin-top:0.6rem;">
                    <div class="mb-3">
                        <div class="input-group">
                            <span class="input-group-text"><i class="bi bi-envelope-fill"></i></span>
                            <input id="email" type="email" class="form-control" placeholder="email" required>
                        </div>
                        <div class="invalid-feedback">Please enter a valid email address.</div>
                    </div>

                    <div class="mb-3">
                        <div class="input-group">
                            <span class="input-group-text"><i class="bi bi-lock-fill"></i></span>
                            <input id="password" type="password" class="form-control" placeholder="password"
                                minlength="6" required>
                            <button id="togglePassword" type="button" class="btn btn-sm input-group-text"
                                aria-label="Toggle password visibility">
                                <i class="bi bi-eye"></i>
                            </button>
                        </div>
                        <div class="invalid-feedback">Please enter your password (min 6 characters).</div>
                    </div>

                    <div class="d-flex align-items-center justify-content-between mb-3">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="remember">
                            <label class="form-check-label muted" for="remember">Remember me</label>
                        </div>
                        <a href="./forgotPassword.html" class="text-decoration-none"
                            style="color:var(--accent); font-weight:600;">Forgot?</a>
                    </div>

                    <div class="d-grid">
                        <button type="submit" class="submit-btn">Sign in</button>
                    </div>

                    <div class="text-center mt-3 muted" style="font-size:0.88rem;">
                        Don't have an account? <a href="./signup.html" class="text-decoration-none"
                            style="color:var(--accent); font-weight:600;">Create one</a>
                    </div>
                </form>
            </div>

            <!-- Visual side (keeps parity with signup layout; hidden on small screens by your CSS) -->
            <div class="visual-side d-none d-lg-flex" aria-hidden="true">
                <div style="max-width:300px;">
                    <div><img style="width: 200px;" class="logo" src="../../images/logo.png" alt=""></div>
                    <div class="fw-bold fs-3" >Hoste<span style="color: #3b82f6;">Link</span></div>
                    <p class="muted">List rooms, manage bookings, and connect with students or agents. Clean, fast, and
                        secure.</p>
                    <div class="mt-3" style="display:flex; gap:.5rem; justify-content:center;">
                        <i class="bi bi-person-standing"
                            style="width:60px; height:60px; border-radius:12px; background:linear-gradient(135deg,var(--accent),var(--accent-2)); display:flex; align-items:center; justify-content:center; color:#021025; font-weight:700;">
                            </i>
                        <i class="bi bi-link"
                            style="width:60px; height:60px; border-radius:12px; background:linear-gradient(135deg,#ff7ab6,#ffb86b); display:flex; align-items:center; justify-content:center; color:#021025; font-weight:700;">
                        </i>
                        <i class="bi bi-house-door-fill"
                            style="width:60px; height:60px; border-radius:12px; background:linear-gradient(135deg,#7ef7b6,#00d4ff); display:flex; align-items:center; justify-content:center; color:#021025; font-weight:700;">
                    </i>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Session Manager (Capacitor-like preferences) -->
    <script src="../../js/session-manager.js"></script>

    <!-- Auth Guard -->
    <script src="../../js/auth-guard.js"></script>

    <!-- HosteLink Preferences -->
    <script src="../../js/hostel-preferences.js"></script>

    <script>
        // segmented toggle logic (shared behavior with signup)
        const segStudent = document.getElementById('segStudent');
        const segAgent = document.getElementById('segAgent');
        const accountNote = document.getElementById('accountNote');
        let accountType = 'student';

        function setActiveSegment(selectedBtn) {
            [segStudent, segAgent].forEach(btn => btn.classList.remove('active'));
            selectedBtn.classList.add('active');
            accountType = selectedBtn.dataset.value;
            accountNote.textContent = accountType === 'student' ? 'Signing in as a student' : 'Signing in as an agent';
        }

        segStudent.addEventListener('click', () => setActiveSegment(segStudent));
        segAgent.addEventListener('click', () => setActiveSegment(segAgent));

        // Password toggle
        const togglePassword = document.getElementById('togglePassword');
        const passwordInput = document.getElementById('password');
        togglePassword.addEventListener('click', () => {
            const type = passwordInput.type === 'password' ? 'text' : 'password';
            passwordInput.type = type;
            togglePassword.innerHTML = type === 'password' ? '<i class="bi bi-eye"></i>' : '<i class="bi bi-eye-slash"></i>';
        });

        // Form validation + submit handler
        const form = document.getElementById('loginForm');
        form.addEventListener('submit', async function (e) {
            e.preventDefault();
            if (!form.checkValidity()) {
                form.classList.add('was-validated');
                const firstInvalid = form.querySelector(':invalid');
                if (firstInvalid) firstInvalid.focus();
                return;
            }

            const credentials = {
                email: document.getElementById('email').value.trim(),
                password: document.getElementById('password').value
            };

            const btn = form.querySelector('button[type="submit"]');
            btn.disabled = true;
            btn.textContent = 'Signing in...';

            try {
                const response = await fetch('/HosteLink/backend/routes/authRoutes.php/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        role: accountType,
                        credentials: credentials
                    })
                });

                const data = await response.json();

                if (data.success) {
                    // Create authenticated session using session manager (no localStorage)
                    // Only sessionStorage is used for auto-login within this session
                    const userInfo = {
                        name: data.name || credentials.email,
                        email: credentials.email,
                        role: accountType,
                        userId: data.user_id
                    };

                    window.hostelSession.setAuthSession(
                        data.token || 'temp_' + Date.now(),
                        data.user_id,
                        userInfo
                    );

                    // Redirect to dashboard
                    window.location.href = '/HosteLink/frontend/views/dashboard/profile.html';
                } else {
                    alert('Login failed: ' + (data.message || 'Unknown error'));
                    btn.disabled = false;
                    btn.textContent = 'Sign in';
                }
            } catch (error) {
                console.error('Login error:', error);
                alert('Error: ' + error.message);
                btn.disabled = false;
                btn.textContent = 'Sign in';
            }
        });

        // initialize default
        setActiveSegment(segStudent);
    </script>
</body>

</html>